<!-- templates/finance/transaction_list.html -->
{% extends 'base.html' %}

{% block title %}Financial Transactions - Inter Emirates ERP{% endblock %}

{% block extra_css %}
    <style>
        .type-purchase { background-color: #dbeafe; color: #1e40af; }
        .type-sale { background-color: #d1fae5; color: #047857; }
        .type-production { background-color: #fef3c7; color: #b45309; }
        .type-maintenance { background-color: #e5e7eb; color: #4b5563; }
        .type-adjustment { background-color: #f3e8ff; color: #6d28d9; }
        .type-transfer { background-color: #ffedd5; color: #ea580c; }
        .table-row:hover { background-color: #f3f4f6; }
    </style>
{% endblock %}

{% block content %}
    <div class="max-w-7xl mx-auto p-6">
        <h1 class="text-2xl font-bold text-gray-900 mb-6">Financial Transactions</h1>

        <div class="bg-white p-6 rounded-lg shadow-md">
            <!-- Filter Form -->
            <form method="get" class="mb-6 flex flex-col md:flex-row md:items-end gap-4">
                <div class="flex-1">
                    <label for="search" class="block text-sm font-medium text-gray-700">Search</label>
                    <input type="text" name="search" id="search" value="{{ request.GET.search }}"
                           class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Search by reference number or description">
                </div>
                <div>
                    <label for="transaction_type" class="block text-sm font-medium text-gray-700">Transaction Type</label>
                    <select name="transaction_type" id="transaction_type"
                            class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">All Types</option>
                        {% for value, label in transactions.model.TRANSACTION_TYPES %}
                            <option value="{{ value }}" {% if request.GET.transaction_type == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    Filter
                </button>
            </form>

            <!-- Transactions Table -->
            {% if transactions %}
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
    <tr class="bg-gray-100">
        <th class="p-3 text-gray-700 font-semibold">Reference #</th>
        <th class="p-3 text-gray-700 font-semibold">Type</th>
        <th class="p-3 text-gray-700 font-semibold">Amount</th>
        <th class="p-3 text-gray-700 font-semibold">Date</th>
        <th class="p-3 text-gray-700 font-semibold">Created By</th>
        <th class="p-3 text-gray-700 font-semibold">Journal #</th>   <!-- NEW -->
    </tr>
</thead>
<tbody>
    {% for transaction in transactions %}
        <tr class="border-b table-row type-{{ transaction.transaction_type }}">
            <td class="p-3">{{ transaction.reference_number }}</td>
            <td class="p-3">{{ transaction.get_transaction_type_display }}</td>
            <td class="p-3">{{ transaction.amount }}</td>
            <td class="p-3">{{ transaction.transaction_date|date:"Y-m-d H:i" }}</td>
            <td class="p-3">{{ transaction.created_by.username|default:'N/A' }}</td>
            <td class="p-3">
                {% if transaction.journal_entry %}
                    <span class="font-mono text-xs">{{ transaction.journal_entry.entry_number }}</span>
                {% else %}
                    <span class="text-gray-400">â€”</span>
                {% endif %}
            </td>
        </tr>
    {% empty %}
        <tr><td colspan="6" class="p-3 text-center text-gray-500">No transactions found.</td></tr>
    {% endfor %}
</tbody>
                    </table>
                </div>

                <!-- Pagination -->
                {% if is_paginated %}
                    <div class="mt-4 flex justify-center">
                        <nav class="inline-flex rounded-md shadow">
                            {% if page_obj.has_previous %}
                                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.transaction_type %}&transaction_type={{ request.GET.transaction_type }}{% endif %}"
                                   class="px-3 py-2 border rounded-l-md hover:bg-blue-600 hover:text-white">Previous</a>
                            {% endif %}
                            <span class="px-3 py-2 border">{{ page_obj.number }} of {{ paginator.num_pages }}</span>
                            {% if page_obj.has_next %}
                                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.transaction_type %}&transaction_type={{ request.GET.transaction_type }}{% endif %}"
                                   class="px-3 py-2 border rounded-r-md hover:bg-blue-600 hover:text-white">Next</a>
                            {% endif %}
                        </nav>
                    </div>
                {% endif %}
            {% else %}
                <p class="text-gray-600">No transactions found.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}